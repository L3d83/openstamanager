<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>OpenSTAManager</title>

        <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Merriweather:400,900,700,300|Open+Sans:400,800,700|Titillium+Web:600,400' type='text/css'>
        <link rel="stylesheet" href="./css/bootstrap.min.css">
        <link rel="stylesheet" href="./css/font-awesome.min.css">
        <link rel="stylesheet" href="./css/github.css">
        <link rel="stylesheet" href="./css/main.css">
    </head>
    <body>

        <header class="site-header">
            <div class="site-branding">
                <h1 class="site-name">
                    <a href="." >OpenSTAManager</a>&nbsp;&nbsp;<i class="fa fa-cog"></i>
                </h1>
                <h2 class="site-description">Il gestionale open source per l'assistenza tecnica e la fatturazione</h2>
            </div>

            <div class="button-line">
                <a href="https://github.com/devcode-it/openstamanager" target="_blank" class="btn btn-default">View on GitHub</a>
                <a href="https://github.com/devcode-it/openstamanager/zipball/master" class="btn btn-default hidden-xs">Download .zip</a>
                <a href="https://github.com/devcode-it/openstamanager/tarball/master" class="btn btn-default hidden-xs">Download .tar.gz</a>
            </div>

                            <a href="https://github.com/devcode-it/openstamanager">
                    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
                </a>
            
            <div class="text-left visible-xs-block" style="margin-left: 15px;">
                <a href="#sidebar" data-toggle="collapse"><i class="fa fa-3x fa-bars" aria-hidden="true"></i></a>
            </div>
        </header>

        <main class="container-fluid">
            <div class="row">

                                    <nav id="sidebar" class="col-sm-3 col-lg-2 collapse in" role="navigation">
                                                    <p class="text-muted">
                                Documentazione di base
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="./index.html">
                                            Home page
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="./installazione.html">
                                            Installazione
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="./framework.html">
                                            Framework
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="./assets.html">
                                            Assets
                                        </a>
                                    </li>
                                                                    <li class="active">
                                        <a href="./api.html">
                                            API
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                Approfondimenti
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="./struttura.html">
                                            Struttura
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="./moduli.html">
                                            Moduli
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="./docs/">
                                            Documentazione completa
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://www.openstamanager.com/">
                                            Sito ufficiale
                                        </a>
                                    </li>
                                                            </ul>
                        
                    </nav>

                
                <section class="col-sm-9 col-lg-10 content">
                    <h1 id="api">API</h1>
<blockquote>
<p>Con application programming interface (in acronimo API, in italiano interfaccia di programmazione di un'applicazione), in informatica, si indica ogni insieme di procedure disponibili al programmatore, di solito raggruppate a formare un set di strumenti specifici per l'espletamento di un determinato compito all'interno di un certo programma.</p>
<p>-- <cite><a href="https://it.wikipedia.org/wiki/Application_programming_interface">Wikipedia</a></cite></p>
</blockquote>
<p>L'API del progetto è attualmente ancora in sviluppo, e pertanto le funzioni disponibili potrebbero essere piuttosto ridotte.
Di seguito sono elencate le basi per connettersi al sistema e ottenere i dati a cui si è interessati.</p>
<!-- TOC depthFrom:2 depthTo:6 orderedList:false updateOnSave:true withLinks:true -->
<ul>
<li><a href="#standard-di-comunicazione">Standard di comunicazione</a>
<ul>
<li><a href="#ottenere-la-chiave">Ottenere la chiave</a></li>
<li><a href="#formato-dei-componenti">Formato dei componenti</a></li>
</ul></li>
<li><a href="#output">Output</a>
<ul>
<li><a href="#stati">Stati</a></li>
<li><a href="#lettura">Lettura</a></li>
</ul></li>
<li><a href="#personalizzazione">Personalizzazione</a></li>
<li><a href="#richieste-di-lettura">Richieste di lettura</a>
<ul>
<li><a href="#interventi">Interventi</a></li>
<li><a href="#anagrafiche">Anagrafiche</a></li>
<li><a href="#richieste-disabilitate">Richieste disabilitate</a>
<ul>
<li><a href="#modifiche">Modifiche</a></li>
<li><a href="#eliminazioni">Eliminazioni</a></li>
</ul></li>
</ul></li>
</ul>
<!-- /TOC -->
<h2 id="standard-di-comunicazione">Standard di comunicazione</h2>
<p>Il funzionamento dell'API si basa fondamentalmente sull'utilizzo di una chiave di accesso, ospitata all'interno della tabella <code>zz_tokens</code> del database del progetto, univoca per ogni istanza dell'utente.</p>
<p>Ogni richiesta all'API deve contenere la chiave di accesso (campo <code>token</code>) e l'operazione richiesta (campo <code>resource</code>), inserendo questi elementi tra gli ulteriori contenuti che si intendono inviare.
I contenuti della richiesta devono quindi essere convertiti in formato JSON ed inviati all'API secondo uno specifico schema:</p>
<ul>
<li><code>POST</code> - Richieste di creazione (<strong>Create</strong>).</li>
<li><code>GET</code> - Richieste di informazioni (<strong>Retrieve</strong>).</li>
<li><code>PUT</code> - Richieste di modifica (<strong>Update</strong>).</li>
<li><code>DELETE</code> - Richieste di eliminazione (<strong>Delete</strong>).</li>
</ul>
<h3 id="ottenere-la-chiave">Ottenere la chiave</h3>
<p>La chiave di accesso può essere ottenuta sfruttando l'operazione di accesso nativa dell'API, che prevede l'invio di una richiesta <strong>POST</strong> corrispondente alla seguente struttura:</p>
<ul>
<li><code>resource</code> - login.</li>
<li><code>username</code> - &lt;username dell'account&gt;.</li>
<li><code>password</code> - &lt;password dell'account&gt;.</li>
</ul>
<h3 id="formato-dei-componenti">Formato dei componenti</h3>
<p>I seguenti componenti delle richieste devono seguire una rigida struttura:</p>
<ul>
<li><code>page</code> - intero.</li>
<li><code>upd</code> - yyyy-MM-dd hh:mm:ss.</li>
</ul>
<h2 id="output">Output</h2>
<p>L'API del progetto permette di ottenere le informazioni attraverso un array in formato JSON.</p>
<h3 id="stati">Stati</h3>
<p>Ogni richiesta effettuata all'API viene accompagnata da un messaggio predefinito che permette di interpretare in modo più preciso la risposta.
In particolare, sono presenti i seguenti <em>status</em>:</p>
<ul>
<li><code>200: OK</code> - La richiesta è andata a buon fine.</li>
<li><code>400: Errore interno dell'API</code> - La richiesta effettuata risulta invalida per l'API.</li>
<li><code>401: Non autorizzato</code> - Accesso non autorizzato.</li>
<li><code>404: Non trovato</code> - La risorsa richiesta non risulta disponibile.</li>
<li><code>500: Errore del server</code> - Il gestionale non è in grado di completare la richiesta.</li>
<li><code>503: Servizio non disponibile</code> - L'API del gestionale non è abilitata.</li>
</ul>
<h3 id="lettura">Lettura</h3>
<p>Le richieste di lettura sono solitamente completate con l'invio di un numero predefinito di informazioni.
Per poter interpretare correttamente i dati, si devono ignorare gli indici numerici di primo livello (non rilevanti all'interno del formato) e sfruttare in particolare i seguenti campi generici:</p>
<ul>
<li><code>records</code>, rappresentante il numero totale dei record richiesti;</li>
<li><code>pages</code>, indicante il numero totale della pagine disponibili.</li>
</ul>
<p>Si ricorda che l'API prevede la restituzione di un insieme di dati limitato rispetto alla richiesta effettuatua: per ottenere l'intero insieme di informazioni è necessario eseguire molteplici richieste consecutive basate sul campo <code>page</code>.</p>
<h2 id="personalizzazione">Personalizzazione</h2>
<p>L'API sfrutta una struttura modulare per poter funzionare in modo completo e garantire al tempo stesso il possibile ampliamento delle sue funzioni.
In particolare, ogni modulo può specificare una determinata serie di operazioni che lo riguardano e che possono essere richiamate in vari modi.</p>
<p>Di seguito lo schema attraverso cui l'API individua la presenza delle possibili richieste supportate dai moduli (cartelle <strong>api/</strong> e <strong>custom/api/</strong>):</p>
<ul>
<li><code>POST</code> - File <code>create.php</code>.</li>
<li><code>GET</code> - File <code>retrieve.php</code>.</li>
<li><code>PUT</code> - File <code>update.php</code>.</li>
<li><code>DELETE</code> - File <code>delete.php</code>.</li>
</ul>
<h2 id="richieste-di-lettura">Richieste di lettura</h2>
<h3 id="interventi">Interventi</h3>
<p>Tutto il contenuto della tabella in_interventi:</p>
<pre><code>http://&lt;url_osm&gt;/api/?token=&lt;token&gt;&amp;resource=in_interventi</code></pre>
<p>Singolo intervento (riga della tabella):</p>
<pre><code>http://&lt;url_osm&gt;/api/?token=&lt;token&gt;&amp;resource=in_interventi&amp;filter[id]=[1]</code></pre>
<h3 id="anagrafiche">Anagrafiche</h3>
<p>Tutto il contenuto della tabella an_anagrafiche:</p>
<pre><code>http://&lt;url_osm&gt;/api/?token=&lt;token&gt;&amp;resource=an_anagrafiche</code></pre>
<p>Singolo intervento (riga della tabella):</p>
<pre><code>http://&lt;url_osm&gt;/api/?token=&lt;token&gt;&amp;resource=an_anagrafiche&amp;filter[idanagrafica]=[1]</code></pre>
<p>Ricerca per ragione sociale:</p>
<pre><code>http://&lt;url_osm&gt;/api/?token=&lt;token&gt;&amp;resource=an_anagrafiche&amp;filter[ragione_sociale]=[%&lt;stringa_ragione_sociale&gt;%]</code></pre>
<h3 id="richieste-disabilitate">Richieste disabilitate</h3>
<h4 id="modifiche">Modifiche</h4>
<p>Tutti i contenuti di tutte le tabelle:</p>
<pre><code>http://&lt;url_osm&gt;/api/?token=&lt;token&gt;&amp;resource=updates</code></pre>
<p>Tutti i contenuti di tutte le tabelle, aggiornati a partire da una data precisa:</p>
<pre><code>http://&lt;url_osm&gt;/api/?token=&lt;token&gt;&amp;resource=updates&amp;upd=2016-01-31%2010:44:31</code></pre>
<h4 id="eliminazioni">Eliminazioni</h4>
<p>Tutte le eliminazioni di tutte le tabelle:</p>
<pre><code>http://&lt;url_osm&gt;/api/?token=&lt;token&gt;&amp;resource=deleted</code></pre>
                </section>

            </div>
        </main>

        <footer class="site-footer">
            <div class="top-bar-line"></div>
            <div class="bottom-panel">
                <div class="text-center">
            <span>
                                    Progettato e sviluppato da DevCode.
                                                </span>
                </div><!-- text-center -->
            </div><!-- bottom-panel -->
        </footer>


        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script src="./js/highlight.pack.js"></script>

        <script>
            hljs.initHighlighting();

            function checkWidth($highlight) {
                if ($(window).width() < 768) {
                    $highlight.addClass('collapse');
                } else {
                    $highlight.removeClass('collapse');
                }
            }

            $(document).ready(function () {
                var $highlights = $('.hljs');
                $highlights.each(function (index) {
                    var $this = $(this).parent();
                    var elementId = 'hljs' + index;
                    $this.attr('id', elementId);
                    $this.before('<a class="visible-xs-inline visible-sm-inline" href="#' + elementId + '" data-toggle="collapse"><i class="fa fa-expand"></i>&nbsp;Toggle source code ...</a>');

                    checkWidth($this);
                    $(window).resize(function () {
                        checkWidth($this);
                    });
                });
            });

                            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-42808312-1', 'auto');
                ga('send', 'pageview');
            
        </script>

    </body>
</html>
